<script>
  const API_KEY = "goldapi-h5rolsmkzbgcc5-io"; // tumhari existing key

  const refreshBtn = document.getElementById("refreshBtn");
  let isLoading = false;

  async function loadGoldPrice() {
    const errorEl = document.getElementById("error");
    errorEl.innerText = "";

    if (isLoading) return;
    isLoading = true;
    refreshBtn.disabled = true;
    refreshBtn.innerText = "Refreshing...";

    try {
      const res = await fetch("https://www.goldapi.io/api/XAU/USD", {
        headers: {
          "x-access-token": API_KEY
        }
      });

      if (!res.ok) throw new Error("API limit / network issue");

      const data = await res.json();
      const ounceUSD = data.price;

      if (!ounceUSD || isNaN(ounceUSD)) {
        throw new Error("Invalid price");
      }

      document.getElementById("ounceUSD").innerText =
        `Gold per Ounce (USD): ${ounceUSD.toFixed(2)}`;

      const gold24gm = (ounceUSD * 1.4485 + 15) / 116.64;
      const gold22gm = gold24gm * 0.921;
      const gold21gm = gold24gm * 0.880;
      const gold18gm = gold24gm * 0.755;
      const tola21 = gold21gm * 11.664;

      document.getElementById("g24").innerText = gold24gm.toFixed(3);
      document.getElementById("g22").innerText = gold22gm.toFixed(3);
      document.getElementById("g21gm").innerText = gold21gm.toFixed(3);
      document.getElementById("g18").innerText = gold18gm.toFixed(3);
      document.getElementById("tola21").innerText = tola21.toFixed(2);

      const now = new Date();
      const muscatTime = now.toLocaleString("en-US", {
        timeZone: "Asia/Muscat",
        dateStyle: "medium",
        timeStyle: "short"
      });

      document.getElementById("time").innerText =
        `Last updated: ${muscatTime} (Muscat Time)`;

    } catch (err) {
      console.error(err);
      errorEl.innerText =
        "Rate load nahi ho raha (API limit ya net issue). Thodi der baad try karo.";
      document.getElementById("ounceUSD").innerText =
        "Gold per Ounce (USD): Error";
    } finally {
      isLoading = false;
      refreshBtn.disabled = false;
      refreshBtn.innerText = "Refresh Rates";
    }
  }

  window.addEventListener("load", loadGoldPrice);
  refreshBtn.addEventListener("click", loadGoldPrice);
</script>
